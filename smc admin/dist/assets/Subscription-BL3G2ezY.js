import{r as n,b as w,j as e,M as P,S as I,t as g,A as C,y,c as v}from"./index-SrRR53CN.js";import{b as S,P as z,C as F,a as k,E as D,u as f,w as M}from"./jspdf.plugin.autotable-CpiesQTS.js";import{F as $}from"./index-CGNKdk-r.js";import E from"./html2canvas.esm-CBrSDip1.js";import"./typeof-QjJsDpFa.js";const _=({onClose:d,invoiceData:j})=>{const[a,p]=n.useState([]),[m,h]=n.useState(!1),o=n.useRef();n.useEffect(()=>{b()},[]);const b=async()=>{try{const c=(await w.get(j)).data.sub;p(c)}catch(r){console.log(r)}},N=async()=>{h(!0);try{const r=await E(o.current,{scale:2}),c=r.toDataURL("image/png"),s=new S("p","mm","a4"),t=s.internal.pageSize.getWidth(),i=r.height*t/r.width;s.addImage(c,"PNG",0,0,t,i),s.save("SMC_Invoice.pdf"),y.success("Invoice downloaded as PDF!")}catch(r){console.error("Error generating PDF:",r),y.error("Failed to generate PDF.")}finally{h(!1)}},x=(r,c)=>{const s=c==="stripe",t=c==="razorpay";return s?`$ ${r}`:t?`₹ ${r}`:`${r}`},u=(r,c)=>{const s=c==="stripe",t=c==="razorpay";return s?`${r} USD`:t?`${r} INR`:`${r}`};return e.jsx(P,{children:e.jsxs("div",{className:"bg-white",children:[a&&e.jsxs("div",{className:"max-w-xl h-auto bg-white py-1 px-2 font-poppins font-extralight",ref:o,children:[e.jsx("span",{className:"flex justify-center my-3",children:e.jsx("img",{src:I,alt:"Image",className:"w-48 "})}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsxs("div",{className:"col-span-6 font-normal",children:[e.jsx("p",{className:"font-normal",children:"Payment Method:"}),e.jsx("p",{children:"Plan:"}),e.jsx("p",{children:"Subscription ID:"}),e.jsx("p",{children:"Customer ID:"}),e.jsx("p",{children:"Amount:"})]}),e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{children:a.method}),e.jsx("p",{children:a.plan}),e.jsx("p",{children:a.subscriberId}),e.jsx("p",{children:"cus_QXoP8hrt4tOqIh"}),e.jsx("p",{children:u(a.amount,a.method)})]})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsxs("div",{className:"col-span-6 font-normal ",children:[e.jsx("p",{children:"Receipt #:"}),e.jsx("p",{children:"Date:"})]}),e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{children:"256746746444"}),e.jsx("p",{children:g(a.date)})]})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3",children:[e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{className:"font-normal",children:"Basic Monthly Plan:"}),e.jsxs("p",{children:["Qty ",a.course]})]}),e.jsx("div",{className:"col-span-6 ",children:e.jsx("p",{children:x(a.amount,a.method)})})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{className:"font-normal",children:"Tax:"}),e.jsxs("p",{children:[a.tax,"%"]})]}),e.jsx("div",{className:"col-span-6 ",children:e.jsx("p",{children:a.method==="razorpay"?`₹ ${(Number(a.tax)/100).toFixed(2)}`:`$ ${(Number(a.tax)/100).toFixed(2)}`})})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsx("div",{className:"col-span-6 font-normal",children:e.jsx("p",{children:"Grand Total:"})}),e.jsx("div",{className:"col-span-6 ",children:a.amount&&a.tax&&e.jsx("p",{children:a.method==="razorpay"?`₹ ${(Number(a.amount)+Number(a.tax)/100).toFixed(0)}`:`$ ${(Number(a.amount)+Number(a.tax)/100).toFixed(2)}`})})]})]}),e.jsxs("div",{className:"flex justify-evenly items-center my-8 ",children:[e.jsx("p",{onClick:d,className:" cursor-pointer text-lg  bg-white  border-2 border-black text-center text-black px-10 py-2.5  ",children:"Cancel"}),e.jsx("button",{className:`text-lg  bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] w-52 py-2.5 ${m?"opacity-15":""}`,disabled:m,onClick:N,children:m?e.jsxs("span",{className:"flex justify-center gap-3",children:[" ",e.jsx(C,{className:"h-6 w-6 animate-spin"})," ",e.jsx("p",{children:"Downloading ...."})]}):"Download Invoice"})]})]})})},B=({permissions:d})=>{const j=d==null?void 0:d.includes("view"),[a,p]=n.useState(!1),[m,h]=n.useState({}),[o,b]=n.useState([]);n.useEffect(()=>{N()},[]);const N=async()=>{try{const t=(await w.get(`${v}/api/getallsubs`)).data.sub;b(t)}catch(s){console.log(s)}},x=()=>o.map(s=>({"User Id":s._id,"First Name":s.fname,"Last Name":s.lname,Email:s.email,Phone:s.phone,Date:g(s.date),Plan:s.plan,Amount:s.amount,Transaction:s.subscriberId,"Payment Mode":s.method})),u=()=>{const s=f.json_to_sheet(x()),t=[{wpx:180},{wpx:100},{wpx:100},{wpx:180},{wpx:80},{wpx:80},{wpx:80},{wpx:80},{wpx:80},{wpx:80}];s["!cols"]=t;const i=f.book_new();f.book_append_sheet(i,s,"subscription"),M(i,"SMC Subscription.xlsx")},r=()=>{const s=new S,t=["User Id","First Name","Last Name","Email","Phone","Date","Plan","Amount","Transaction","Payment Mode"],i=x().map(l=>[l["User Id"],l["First Name"],l["Last Name"],l.Email,l.Phone,l.Date,l.Plan,l.Amount,l.Transaction,l["Payment Mode"]]);s.autoTable({head:[t],body:i,startY:20,theme:"grid",headStyles:{fillColor:[97,144,213],textColor:[255,255,255],fontStyle:"bold",halign:"center"},bodyStyles:{textColor:[0,0,0],halign:"center"}}),s.save("SMC_Subscription.pdf")},c=s=>{h(`${v}/api/getsubonid/${s}`),p(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:" font-poppins h-full",children:[e.jsxs("div",{className:"flex justify-between items-center my-2",children:[e.jsx("p",{className:" mx-2 mt-6",children:"Subscription"}),e.jsxs("div",{className:" mx-2 flex gap-6 mt-4",children:[e.jsx("button",{onClick:r,children:e.jsx("img",{className:"size-8",src:z,alt:"Pdf image"})}),e.jsx(F,{data:x(),filename:"SMC_Subscription.csv",className:"cursor-pointer",target:"_blank",children:e.jsx("img",{className:"size-8",src:k,alt:"csv image"})}),e.jsx("button",{onClick:u,children:e.jsx("img",{className:" size-8",src:D,alt:"excel image"})})]})]}),e.jsx("div",{className:"mx-1 overflow-auto no-scrollbar ",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"",children:e.jsx("tr",{className:"  text-xs text-nowrap text-black  bg-cyan-300 ",children:["User ID","Transaction ID","First Name","Last Name ","Email","Phone","Date","Status","Plan","Billing Cycle","Amount","Next Renewal","Payment Method","Referred By Email","Action"].map(s=>e.jsx("th",{className:"p-2 border-gray-100 border-[1px] ",children:e.jsx("h1",{className:"flex items-center justify-center  gap-1",children:s})},s))})}),e.jsx("tbody",{className:"text-slate-100 font-extralight text-sm  ",children:o&&o.map((s,t)=>e.jsxs("tr",{className:" text-nowrap text-center",children:[e.jsx("td",{className:"p-1 border border-slate-100  ",children:s._id}),e.jsxs("td",{className:" p-1 border border-slate-100 capitalize ",children:[s.fname," "]}),e.jsx("td",{className:"p-1 border border-slate-100 capitalize ",children:s.lname}),e.jsx("td",{className:"p-1 border border-slate-100",children:s.email}),e.jsx("td",{className:"p-1 border border-slate-100",children:s.phone}),e.jsx("td",{className:"p-1 border border-slate-100",children:g(s.date)}),e.jsxs("td",{className:"p-1 border border-slate-100 px-2 capitalize ",children:[" ",s.plan]}),e.jsx("td",{className:"p-1 border border-slate-100 ",children:s.amount}),e.jsx("td",{className:"p-1 border border-slate-100 ",children:s.subscriberId}),e.jsx("td",{className:"p-1 border border-slate-100 capitalize",children:s.method}),e.jsx("td",{className:"p-1 border border-slate-100 capitalize",children:s.method}),e.jsx("td",{className:"p-1 border border-slate-100 capitalize",children:s.method}),e.jsx("td",{className:"p-1 border border-slate-100 capitalize",children:s.method}),e.jsx("td",{className:"p-1 border border-slate-100 capitalize",children:s.method}),e.jsx("td",{className:" p-1 border-b border-r border-slate-100 flex  justify-center items-center  ",children:j&&e.jsx("p",{onClick:()=>c(s._id),className:" cursor-pointer p-2  text-green-600 ",children:e.jsx($,{size:24})})})]},t))})]})})]}),a&&e.jsx(_,{onClose:()=>p(),invoiceData:m})]})};export{B as default};
