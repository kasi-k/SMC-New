import{u as N,r as l,b as u,c as f,j as s,t as d,v as w,E as g}from"./index-DgKZBfYf.js";import{P as y}from"./pdf-DuUmbbx2.js";import{C as v,a as S,E as P,u as i,w as E}from"./jspdf.plugin.autotable-lZWRLWXJ.js";const T=({permissions:o})=>{const m=N(),x=o==null?void 0:o.includes("view"),[C,I]=l.useState(!1),[z,_]=l.useState({}),[c,p]=l.useState([]);l.useEffect(()=>{b()},[]);const b=async()=>{try{const r=(await u.get(`${f}/api/getallsubs`)).data.sub;p(r)}catch(e){console.log(e)}},n=()=>c.map(e=>({"User Id":e._id,"First Name":e.fname,"Last Name":e.lname,Email:e.email,Phone:e.phone,Date:d(e.date),Plan:e.plan,Amount:e.amount,Transaction:e.subscriberId,"Payment Mode":e.method})),h=()=>{const e=i.json_to_sheet(n()),r=[{wpx:180},{wpx:100},{wpx:100},{wpx:180},{wpx:80},{wpx:80},{wpx:80},{wpx:80},{wpx:80},{wpx:80}];e["!cols"]=r;const a=i.book_new();i.book_append_sheet(a,e,"subscription"),E(a,"SMC Subscription.xlsx")},j=()=>{const e=new g,r=["User Id","First Name","Last Name","Email","Phone","Date","Plan","Amount","Transaction","Payment Mode"],a=n().map(t=>[t["User Id"],t["First Name"],t["Last Name"],t.Email,t.Phone,t.Date,t.Plan,t.Amount,t.Transaction,t["Payment Mode"]]);e.autoTable({head:[r],body:a,startY:20,theme:"grid",headStyles:{fillColor:[97,144,213],textColor:[255,255,255],fontStyle:"bold",halign:"center"},bodyStyles:{textColor:[0,0,0],halign:"center"}}),e.save("SMC_Subscription.pdf")};return s.jsx(s.Fragment,{children:s.jsxs("div",{className:" font-poppins h-full",children:[s.jsxs("div",{className:"flex justify-between items-center my-2",children:[s.jsx("p",{className:" mx-2 mt-6",children:"Subscription"}),s.jsxs("div",{className:" mx-2 flex gap-6 mt-4",children:[s.jsx("button",{onClick:j,children:s.jsx("img",{className:"size-8",src:y,alt:"Pdf image"})}),s.jsx(v,{data:n(),filename:"SMC_Subscription.csv",className:"cursor-pointer",target:"_blank",children:s.jsx("img",{className:"size-8",src:S,alt:"csv image"})}),s.jsx("button",{onClick:h,children:s.jsx("img",{className:" size-8",src:P,alt:"excel image"})})]})]}),s.jsx("div",{className:"mx-1 overflow-auto no-scrollbar ",children:s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"",children:s.jsx("tr",{className:"  text-xs text-nowrap text-black  bg-cyan-300 ",children:["User ID","Transaction ID","First Name","Last Name ","Email","Phone","Date","Status","Plan","Billing Cycle","Amount","Next Renewal","Payment Method","Referred By Email","Action"].map(e=>s.jsx("th",{className:"p-2 border-gray-100 border-[1px] ",children:s.jsx("h1",{className:"flex items-center justify-center  gap-1",children:e})},e))})}),s.jsx("tbody",{className:"text-slate-100 font-extralight text-sm  ",children:c&&c.map((e,r)=>s.jsxs("tr",{className:" text-nowrap text-center",children:[s.jsx("td",{className:"p-1 border border-slate-100  ",children:e._id}),s.jsxs("td",{className:" p-1 border border-slate-100 capitalize ",children:[e.fname," "]}),s.jsx("td",{className:"p-1 border border-slate-100 capitalize ",children:e.lname}),s.jsx("td",{className:"p-1 border border-slate-100",children:e.email}),s.jsx("td",{className:"p-1 border border-slate-100",children:e.phone}),s.jsx("td",{className:"p-1 border border-slate-100",children:d(e.date)}),s.jsxs("td",{className:"p-1 border border-slate-100 px-2 capitalize ",children:[" ",e.plan]}),s.jsx("td",{className:"p-1 border border-slate-100 ",children:e.amount}),s.jsx("td",{className:"p-1 border border-slate-100 ",children:e.subscriberId}),s.jsx("td",{className:"p-1 border border-slate-100 capitalize",children:e.method}),s.jsx("td",{className:"p-1 border border-slate-100 capitalize",children:e.method}),s.jsx("td",{className:"p-1 border border-slate-100 capitalize",children:e.method}),s.jsx("td",{className:"p-1 border border-slate-100 capitalize",children:e.method}),s.jsx("td",{className:"p-1 border border-slate-100 capitalize",children:e.method}),s.jsx("td",{className:" p-1 border-b border-r border-slate-100 flex  justify-center items-center  ",children:x&&s.jsx("p",{onClick:()=>m("/viewinvoice",{state:{subId:e._id}}),className:" cursor-pointer p-2  text-green-600 ",children:s.jsx(w,{size:24})})})]},r))})]})})]})})};export{T as default};
